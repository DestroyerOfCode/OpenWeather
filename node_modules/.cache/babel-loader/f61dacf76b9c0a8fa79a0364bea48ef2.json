{"ast":null,"code":"import _regeneratorRuntime from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{Component}from'react';import WeatherService from'../service/WeatherService';import Pagination from'./Pagination';import FiltersComponent from'./FiltersComponent';import{usePromiseTracker}from\"react-promise-tracker\";var WeatherListComponent=/*#__PURE__*/function(_Component){_inherits(WeatherListComponent,_Component);var _super=_createSuper(WeatherListComponent);function WeatherListComponent(props){var _this;_classCallCheck(this,WeatherListComponent);_this=_super.call(this,props);_this.addFilterOperatorToExistingFilterName=function(event,filterName,filterOperator){var arr=_this.state.filters;arr.forEach(function(item,index,filters){if(item.hasOwnProperty([filterName])){filters[index][filterName][filterOperator]=event;}});return arr;};_this.onChangeFilter=function(event,filterName,filterOperator){// console.log(\"event: \" + JSON.stringify(event))\n// console.log(\"filters: \" + JSON.stringify(this.state.filters))\nif(event===\"\"&&_this.keyExistsInArr(_this.state.filters,filterName)){console.log(\"inside 1\");var index=_this.findIndexInFilters(_this.state.filters,filterName);_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:false,filters:_this.changeFilters(index,filterName,filterOperator)},function(){this.refreshWeathers(this.state.sortBy,this.state.weathers);});}else if(event!==\"\"&&!_this.keyExistsInArr(_this.state.filters,filterName)){console.log(\"inside 2\");_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:true,filters:_this.state.filters.concat([_defineProperty({},filterName,_defineProperty({},filterOperator,event))])},function(){// console.log(\"filters inside: \" + this.state.filters)\nthis.refreshWeathers(this.state.sortBy,this.state.weathers);});}else if(event!==\"\"&&_this.keyExistsInArr(_this.state.filters,filterName)){console.log(\"inside 3\");var index=_this.findIndexInFilters(_this.state.filters,filterName);_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:_this.isAdditionalFilterCheck(event,index,filterName,filterOperator),filters:_this.addFilterOperatorToExistingFilterName(event,filterName,filterOperator)},function(){this.refreshWeathers(this.state.sortBy,this.state.weathers);});}else{console.log(\"inside 4\");}};_this.getWeatherDescription=function(weather){var weatherItemReduce=function weatherItemReduce(prevVal,currVal,idx){return idx===0?currVal.description:prevVal+\", \"+currVal.description;};return weather.weather.reduce(weatherItemReduce,'');};_this.paginate=function(currentPage){_this.setState({currentPage:currentPage},function(){console.log(\"currPage: \"+this.state.currentPage);});};_this.getWeathersOnSpecificPage=function(){console.log('after pagination creation');var indexOfLastPost=_this.state.currentPage*_this.state.itemsPerPage;var indexOfFirstPost=indexOfLastPost-_this.state.itemsPerPage;return _this.state.weathers.slice(indexOfFirstPost,indexOfLastPost);};_this.state={weathers:[],isAscending:true,filters:[],isFilter:false,currentPage:1,itemsPerPage:1000,loading:false,isAdditionalFilter:false,pageNumbers:[],countries:[],descriptions:[]};return _this;}_createClass(WeatherListComponent,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var countries,descriptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"som v componentDidMOunt weather list\");_context.next=3;return WeatherService.retrieveAllCountries();case 3:countries=_context.sent;_context.next=6;return WeatherService.retrieveAllDescriptions();case 6:descriptions=_context.sent;this.setState({countries:countries.data,descriptions:descriptions.data},function(){this.refreshWeathers();});case 8:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"refreshWeathers\",value:function refreshWeathers(sortBy,weathers){var _this2=this;WeatherService.retrieveAllWeathers(sortBy,this.state.isAscending,this.state.filters,this.state.isFilter,this.state.isAdditionalFilter,weathers).then(function(response){_this2.setState({weathers:response.data});}).then(function(){if(sortBy)_this2.setState({isAscending:!_this2.state.isAscending});}).then(function(){if(typeof _this2.state.filters!=='undefined'&&_this2.state.filters===0)_this2.setState({isFilter:false});});}},{key:\"keyExistsInArr\",value:function keyExistsInArr(arr,key){var exists=false;console.log(\"arr inside keyExists: \"+JSON.stringify(arr));if(!Array.isArray(key)){arr===null||arr===void 0?void 0:arr.some(function(item){if(item.hasOwnProperty([key])){exists=true;return true;}else return false;});}//since countries and descriptions is a multicheckbox, they are arrays and it has multiple keys and must check not with equals\nelse{arr===null||arr===void 0?void 0:arr.some(function(item){if(item.includes([key])){exists=true;return true;}else return false;});}return exists;}},{key:\"findIndexInFilters\",value:function findIndexInFilters(arr,key){var indexOfKey=0;arr===null||arr===void 0?void 0:arr.some(function(filterName,index,filters){if(filterName.hasOwnProperty([key])){indexOfKey=index;return indexOfKey;}else return false;});return indexOfKey;}},{key:\"changeFilters\",value:function changeFilters(index,filterName,filterOperator){var arr=this.state.filters;console.log(\"arr inside changefilters: \"+JSON.stringify(arr));if(arr[index][filterName][filterOperator])delete arr[index][filterName][filterOperator];if(Object.keys(arr[index][filterName]).length===0)arr.splice(index,1);return arr;}},{key:\"isAdditionalFilterCheck\",value:function isAdditionalFilterCheck(event,index,filterName,filterOperator){if(this.isNotAdditionalFilterWithContains(event)===false)return false;console.log(\"this.state.filters[index][filterName][filterOperator]: \"+this.state.filters[index][filterName][filterOperator]);if(this.isSameFilterChanged(event,index,filterName,filterOperator)===false)return false;return true;}//if there are multiple countries and descriptions, backend must make a new query\n//since no additional filter is added, only value. I am unable to send query request\n//with an array element\n},{key:\"isNotAdditionalFilterWithContains\",value:function isNotAdditionalFilterWithContains(event){return event.includes(\",\")?false:true;}// this check is here for times when I change the same filter multiple\n// times in a row and the filter is same. If it is the same I cant filter\n// from memory because I could not load some weathers\n},{key:\"isSameFilterChanged\",value:function isSameFilterChanged(event,index,filterName,filterOperator){console.log(\"event: \"+event);console.log(\"this.state.filters[index][filterName][filterOperator]: \"+this.state.filters[index][filterName][filterOperator]);return filterName===this.state.filters[index][filterName];}},{key:\"header\",value:function header(){var _this3=this;return/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"_id\",_this3.state.weathers);},children:\"cityId\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"name\",_this3.state.weathers);},children:\"city Name\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"coord.lat\",_this3.state.weathers);},children:\"latitude\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"coord.lon\",_this3.state.weathers);},children:\"longitude\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"sys.country\",_this3.state.weathers);},children:\"country\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.humidity\",_this3.state.weathers);},children:\"humidity\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.feels_like\",_this3.state.weathers);},children:\"feels like\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp\",_this3.state.weathers);},children:\"temperature\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp_max\",_this3.state.weathers);},children:\"maximum temperature\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp_min\",_this3.state.weathers);},children:\"minimal temperature\"}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weather.description\",_this3.state.weathers);},children:\"description\"})]})});}// descriptions can be multiple per row, to display it I changed its elements to string delimetered by ','\n},{key:\"mainBody\",value:function mainBody(currentPosts){var _this4=this;return/*#__PURE__*/_jsx(\"tbody\",{children:currentPosts.map(function(weather){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:weather._id}),/*#__PURE__*/_jsx(\"td\",{children:weather.name}),/*#__PURE__*/_jsx(\"td\",{children:weather.coord.lat}),/*#__PURE__*/_jsx(\"td\",{children:weather.coord.lon}),/*#__PURE__*/_jsx(\"td\",{children:weather.sys.country}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.humidity}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.feels_like}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.temp}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.temp_max}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.temp_min}),/*#__PURE__*/_jsx(\"td\",{children:_this4.getWeatherDescription(weather)})]},weather._id);})});}},{key:\"render\",value:function render(){console.log(\"som v render weather list\");var _usePromiseTracker=usePromiseTracker(),promiseInProgress=_usePromiseTracker.promiseInProgress;if(promiseInProgress)return/*#__PURE__*/_jsx(\"h3\",{children:\"Hey I'm a spinner loader wannabe !!!\"});var pagination=/*#__PURE__*/_jsx(Pagination,{itemsPerPage:this.state.itemsPerPage,totalItems:this.state.weathers.length,paginate:this.paginate.bind()});var currentWeathers=this.getWeathersOnSpecificPage();var filters=/*#__PURE__*/_jsx(FiltersComponent,{countries:this.state.countries,descriptions:this.state.descriptions,onChangeMethod:this.onChangeFilter});var container=[filters,pagination];if(this.state.weathers)container.push(/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[this.header(),this.mainBody(currentWeathers)]}));return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:container});}}]);return WeatherListComponent;}(Component);export default WeatherListComponent;","map":{"version":3,"sources":["/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/src/component/WeatherListComponent.js"],"names":["React","Component","WeatherService","Pagination","FiltersComponent","usePromiseTracker","WeatherListComponent","props","addFilterOperatorToExistingFilterName","event","filterName","filterOperator","arr","state","filters","forEach","item","index","hasOwnProperty","onChangeFilter","keyExistsInArr","console","log","findIndexInFilters","setState","currentPage","isFilter","isAdditionalFilter","changeFilters","refreshWeathers","sortBy","weathers","concat","isAdditionalFilterCheck","getWeatherDescription","weather","weatherItemReduce","prevVal","currVal","idx","description","reduce","paginate","getWeathersOnSpecificPage","indexOfLastPost","itemsPerPage","indexOfFirstPost","slice","isAscending","loading","pageNumbers","countries","descriptions","retrieveAllCountries","retrieveAllDescriptions","data","retrieveAllWeathers","then","response","key","exists","JSON","stringify","Array","isArray","some","includes","indexOfKey","Object","keys","length","splice","isNotAdditionalFilterWithContains","isSameFilterChanged","currentPosts","map","_id","name","coord","lat","lon","sys","country","weatherMain","humidity","feels_like","temp","temp_max","temp_min","promiseInProgress","pagination","bind","currentWeathers","container","push","header","mainBody"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport WeatherService from '../service/WeatherService';\nimport Pagination from './Pagination';\nimport FiltersComponent from './FiltersComponent'\nimport { usePromiseTracker } from \"react-promise-tracker\";\n \nclass WeatherListComponent extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            weathers: [],\n            isAscending: true,\n            filters: [],\n            isFilter : false,\n            currentPage : 1,\n            itemsPerPage : 1000,\n            loading : false,\n            isAdditionalFilter : false,\n            pageNumbers : [],\n            countries : [],\n            descriptions: []\n        }\n    }\n\n    async componentDidMount() {\n        console.log(\"som v componentDidMOunt weather list\")\n        const countries = await WeatherService.retrieveAllCountries()\n        const descriptions = await WeatherService.retrieveAllDescriptions()\n        this.setState({countries : countries.data, descriptions : descriptions.data}, function() {this.refreshWeathers();})\n        \n    }\n\n    refreshWeathers(sortBy, weathers) {\n\n        WeatherService.retrieveAllWeathers(sortBy, this.state.isAscending, this.state.filters, this.state.isFilter, this.state.isAdditionalFilter, weathers)\n            .then(\n                response => {\n                    this.setState({ weathers: response.data })\n                }\n            ).then( () => {if (sortBy) this.setState({isAscending : !this.state.isAscending})}\n            ).then( () => {if (typeof this.state.filters !== 'undefined' && this.state.filters === 0) this.setState({isFilter : false})})\n    }\n\n    keyExistsInArr(arr, key){\n        let exists = false\n        console.log(\"arr inside keyExists: \" + JSON.stringify(arr))\n        if (!Array.isArray(key)){\n            arr?.some(item => {\n                if(item.hasOwnProperty([key])) {\n                    exists = true;\n                    return true\n                }\n                else return false\n            })\n        }\n        //since countries and descriptions is a multicheckbox, they are arrays and it has multiple keys and must check not with equals\n        else{\n            arr?.some(item => {\n                if(item.includes([key])) {\n                    exists = true;\n                    return true\n                }\n                else return false\n            })\n        }\n        return exists\n    }\n\n    findIndexInFilters(arr, key){\n        let indexOfKey = 0\n        arr?.some((filterName, index, filters) => {\n            if(filterName.hasOwnProperty([key])){ \n                indexOfKey = index\n                return indexOfKey\n            }\n            else return false\n        })\n        return indexOfKey\n    }\n\n    changeFilters(index, filterName, filterOperator) {\n        let arr = this.state.filters\n        console.log(\"arr inside changefilters: \" + JSON.stringify(arr))\n\n        if (arr[index][filterName][filterOperator])\n            delete arr[index][filterName][filterOperator]  \n        if (Object.keys(arr[index][filterName]).length === 0)\n            arr.splice(index, 1)\n        return arr\n    }\n\n    addFilterOperatorToExistingFilterName = (event, filterName, filterOperator) => {\n        const arr = this.state.filters\n        arr.forEach((item, index, filters) => {\n            if (item.hasOwnProperty([filterName])){\n                filters[index][filterName][filterOperator] = event\n            }\n        })\n        return arr\n    }\n\n    onChangeFilter = (event, filterName, filterOperator) => {\n        // console.log(\"event: \" + JSON.stringify(event))\n        // console.log(\"filters: \" + JSON.stringify(this.state.filters))\n\n        if (event === \"\" && this.keyExistsInArr(this.state.filters,filterName))  {\n            console.log(\"inside 1\")\n\n            var index = this.findIndexInFilters(this.state.filters, filterName)\n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : false, filters : this.changeFilters(index, filterName, filterOperator)}, function () {\n                this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n        }\n\n        else if (event !== \"\" && !(this.keyExistsInArr(this.state.filters, filterName))){\n            console.log(\"inside 2\")\n\n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : true,\n                 filters: this.state.filters.concat([{[filterName]: {[filterOperator] : event}}])}, function () {\n                // console.log(\"filters inside: \" + this.state.filters)\n                this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n\n        }\n\n        else if (event !== \"\" && (this.keyExistsInArr(this.state.filters, filterName))){\n           \n            console.log(\"inside 3\")\n            var index = this.findIndexInFilters(this.state.filters, filterName)\n\n            \n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : this.isAdditionalFilterCheck(event, index, filterName, filterOperator), \n                filters : this.addFilterOperatorToExistingFilterName(event, filterName, filterOperator)}, function() {\n                    this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n           \n        }\n        else {\n            console.log(\"inside 4\")\n\n        }\n    }\n\n    isAdditionalFilterCheck(event, index, filterName, filterOperator){\n        if (this.isNotAdditionalFilterWithContains(event) === false)\n            return false\n        console.log(\"this.state.filters[index][filterName][filterOperator]: \" + this.state.filters[index][filterName][filterOperator])\n        if (this.isSameFilterChanged(event, index, filterName, filterOperator) === false)\n            return false\n        return true\n                \n    }   \n\n    //if there are multiple countries and descriptions, backend must make a new query\n    //since no additional filter is added, only value. I am unable to send query request\n    //with an array element\n    isNotAdditionalFilterWithContains(event){\n       return event.includes(\",\") ? false : true\n    }\n    \n    // this check is here for times when I change the same filter multiple\n    // times in a row and the filter is same. If it is the same I cant filter\n    // from memory because I could not load some weathers\n    isSameFilterChanged(event, index, filterName, filterOperator){\n        console.log(\"event: \" + event)\n        console.log(\"this.state.filters[index][filterName][filterOperator]: \" + this.state.filters[index][filterName][filterOperator])\n       return filterName === this.state.filters[index][filterName]\n    }\n    header(){\n       return (<thead>\n       <tr>\n           <th onClick={() =>this.refreshWeathers(\"_id\", this.state.weathers) }>cityId</th>\n           <th onClick={() =>this.refreshWeathers(\"name\", this.state.weathers) }>city Name</th>\n           <th onClick={() =>this.refreshWeathers(\"coord.lat\", this.state.weathers) }>latitude</th>\n           <th onClick={() =>this.refreshWeathers(\"coord.lon\", this.state.weathers) }>longitude</th>\n           <th onClick={() =>this.refreshWeathers(\"sys.country\", this.state.weathers) }>country</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.humidity\", this.state.weathers) }>humidity</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.feels_like\", this.state.weathers) }>feels like</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp\", this.state.weathers) }>temperature</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp_max\", this.state.weathers) }>maximum temperature</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp_min\", this.state.weathers) }>minimal temperature</th>\n           <th onClick={() =>this.refreshWeathers(\"weather.description\", this.state.weathers) }>description</th>                                \n       </tr>\n   </thead>)\n   }\n\n   // descriptions can be multiple per row, to display it I changed its elements to string delimetered by ','\n    getWeatherDescription = (weather) => {\n        var weatherItemReduce = (prevVal, currVal, idx) => {\n            return idx === 0 ? currVal.description : prevVal + \", \" + currVal.description;\n        }\n\n        return weather.weather.reduce(weatherItemReduce, '')\n    }\n\n\n\n   mainBody(currentPosts){\n    return (\n\n    <tbody>\n        {\n            currentPosts.map(\n                weather =>{\n                    return (<tr key={weather._id}>\n                        <td>{weather._id}</td>\n                        <td>{weather.name}</td>\n                        <td>{weather.coord.lat}</td>\n                        <td>{weather.coord.lon}</td>\n                        <td>{weather.sys.country}</td>\n                        <td>{weather.weatherMain.humidity}</td>\n                        <td>{weather.weatherMain.feels_like}</td>\n                        <td>{weather.weatherMain.temp}</td>\n                        <td>{weather.weatherMain.temp_max}</td>\n                        <td>{weather.weatherMain.temp_min}</td>\n                        <td>{this.getWeatherDescription(weather)}</td>\n                    </tr>)}\n            )\n        }\n        </tbody>\n    )\n   }\n\n    paginate = (currentPage) => {\n       this.setState({currentPage : currentPage}, function(){\n           console.log(\"currPage: \" + this.state.currentPage)\n       })\n\n    }\n\n    getWeathersOnSpecificPage = () => {\n        console.log('after pagination creation')\n        const indexOfLastPost = this.state.currentPage * this.state.itemsPerPage;\n        const indexOfFirstPost = indexOfLastPost - this.state.itemsPerPage;\n        return this.state.weathers.slice(indexOfFirstPost, indexOfLastPost);\n    }\n\n    render() {\n        console.log(\"som v render weather list\")\n        const { promiseInProgress } = usePromiseTracker();\n        if (promiseInProgress) return  <h3>Hey I'm a spinner loader wannabe !!!</h3>\n \n        const pagination = <Pagination itemsPerPage = {this.state.itemsPerPage} totalItems = {this.state.weathers.length} paginate={this.paginate.bind()}/>\n\n        const currentWeathers = this.getWeathersOnSpecificPage()\n        const filters = <FiltersComponent countries = {this.state.countries} descriptions = {this.state.descriptions} onChangeMethod={this.onChangeFilter} />\n        let container= [filters, pagination]\n\n        if (this.state.weathers)\n            container.push(<table className=\"table\">\n                {this.header()}\n                {this.mainBody(currentWeathers)}\n            </table>)\n\n        return (\n            <div className=\"container\">\n             {container}\n            </div>\n        )\n         \n    }\n}\nexport default WeatherListComponent\n"]},"metadata":{},"sourceType":"module"}