{"ast":null,"code":"import _regeneratorRuntime from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/node_modules/@babel/runtime/helpers/esm/createSuper\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React from'react';import WeatherCurrentService from'../../adapters/WeatherCurrentService';import Pagination from'../current/Pagination';import FiltersComponent from'./Filters';import{Link}from\"react-router-dom\";import{internationalizeDescriptions,convertTemperature,internationalizeCountries,keyExistsInArr,findIndexInFilters}from'../../businessLogic/WeatherBusinessLogic';import'../../styles/common/Header.scss';import{nanoid}from\"nanoid\";import{connect}from'react-redux';import{saveFilter}from'../../actions';import i18n from'i18next';var WeatherCurrent=/*#__PURE__*/function(_React$Component){_inherits(WeatherCurrent,_React$Component);var _super=_createSuper(WeatherCurrent);function WeatherCurrent(props){var _this;_classCallCheck(this,WeatherCurrent);console.log(props.temperature);_this=_super.call(this,props);_this.addFilterOperatorToExistingFilterName=function(event,filterName,filterOperator){var arr=_this.state.filters;arr.forEach(function(item,index,filters){if(item.hasOwnProperty([filterName])){filters[index][filterName][filterOperator]=event;}});return arr;};_this.onChangeFilter=function(event,filterName,filterOperator){var index;if(event===\"\"&&keyExistsInArr(_this.state.filters,filterName)){index=findIndexInFilters(_this.state.filters,filterName);_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:false,filters:_this.changeFilters(index,filterName,filterOperator)},function(){this.refreshWeathers(this.state.sortBy,this.state.weathers);});}else if(event!==\"\"&&!keyExistsInArr(_this.state.filters,filterName)){_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:true,filters:_this.state.filters.concat([_defineProperty({},filterName,_defineProperty({},filterOperator,event))])},function(){this.refreshWeathers(this.state.sortBy,this.state.weathers);});}else if(event!==\"\"&&keyExistsInArr(_this.state.filters,filterName)){index=findIndexInFilters(_this.state.filters,filterName);_this.setState({currentPage:1,isFilter:true,isAdditionalFilter:_this.isAdditionalFilterCheck(event,index,filterName,filterOperator),filters:_this.addFilterOperatorToExistingFilterName(event,filterName,filterOperator)},function(){this.refreshWeathers(this.state.sortBy,this.state.weathers);});}else{}};_this.createForecast=function(){return/*#__PURE__*/_jsx(Link,{to:\"/forecast\"});};_this.paginate=function(page){// if(currentPage !== 0 && currentPage <= lastPage)\n_this.setState({currentPage:page},function(){});};_this.getWeathersOnSpecificPage=function(){var indexOfLastPost=_this.state.currentPage*_this.state.itemsPerPage;var indexOfFirstPost=indexOfLastPost-_this.state.itemsPerPage;return _this.state.weathers.slice(indexOfFirstPost,indexOfLastPost);};_this.changeLanguage=function(language,i18n){i18n.changeLanguage(language);_this.setState({},function(){_this.setState({language:language});});};_this.state={weathers:[],isAscending:true,filters:[],isFilter:false,currentPage:1,itemsPerPage:1000,loading:false,isAdditionalFilter:false,pageNumbers:[],countries:[],descriptions:[],showPages:5,language:i18n.language,filterComponent:null,temperature:props.temperature};return _this;}//I added temperatureDropdownList, filterscomponent and header here because I do not want to rerender them\n//on every update. I cant use shouldComponentUpdate because they either are not components or are functional\n//meaning they are stateless\n_createClass(WeatherCurrent,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var countries,descriptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"componentDidMount\");console.log(this.state.temperature);_context.next=4;return WeatherCurrentService.retrieveAllCountries();case 4:countries=_context.sent;_context.next=7;return WeatherCurrentService.retrieveAllDescriptions();case 7:descriptions=_context.sent;this.setState({countries:countries.data,descriptions:descriptions.data,filterComponent:/*#__PURE__*/_jsx(FiltersComponent,{temperatureUnits:this.state.temperature.units,countries:internationalizeCountries(countries.data),descriptions:internationalizeDescriptions(descriptions.data),onChangeMethod:this.onChangeFilter},nanoid())},function(){this.refreshWeathers();});case 9:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"refreshWeathers\",value:function refreshWeathers(sortBy,weathers){var _this2=this;WeatherCurrentService.retrieveAllWeathers(sortBy,this.state.isAscending,this.state.filters,this.state.isFilter,this.state.isAdditionalFilter,weathers).then(function(response){_this2.setState({weathers:response.data});}).then(function(){if(sortBy)_this2.setState({isAscending:!_this2.state.isAscending});}).then(function(){if(typeof _this2.state.filters!=='undefined'&&_this2.state.filters===0)_this2.setState({isFilter:false});});}},{key:\"changeFilters\",value:function changeFilters(index,filterName,filterOperator){var arr=this.state.filters;if(arr[index][filterName][filterOperator])delete arr[index][filterName][filterOperator];if(Object.keys(arr[index][filterName]).length===0)arr.splice(index,1);return arr;}},{key:\"isAdditionalFilterCheck\",value:function isAdditionalFilterCheck(event,index,filterName,filterOperator){if(this.isNotAdditionalFilterWithContains(event)===false)return false;if(this.isSameFilterChanged(event,index,filterName,filterOperator)===false)return false;return true;}//if there are multiple countries and descriptions, backend must make a new query\n//since no additional filter is added, only value. I am unable to send query request\n//with an array element\n},{key:\"isNotAdditionalFilterWithContains\",value:function isNotAdditionalFilterWithContains(event){return event.includes(\",\")?false:true;}// this check is here for times when I change the same filter multiple\n// times in a row and the filter is same. If it is the same I cant filter\n// from memory because I could not load some weathers\n},{key:\"isSameFilterChanged\",value:function isSameFilterChanged(event,index,filterName,filterOperator){return filterName===this.state.filters[index][filterName];}},{key:\"header\",value:function header(){var _this3=this;return/*#__PURE__*/_jsx(\"thead\",{className:\"header\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"_id\",_this3.state.weathers);},children:i18n.t(\"current.header.cityId\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"name\",_this3.state.weathers);},children:i18n.t('current.header.cityName')}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"coord.lat\",_this3.state.weathers);},children:i18n.t(\"current.header.latitude\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"coord.lon\",_this3.state.weathers);},children:i18n.t(\"current.header.longitude\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"sys.countryName\",_this3.state.weathers);},children:i18n.t(\"current.header.country\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.humidity\",_this3.state.weathers);},children:i18n.t(\"current.header.humidity\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.feels_like\",_this3.state.weathers);},children:i18n.t(\"current.header.feelsLike\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp\",_this3.state.weathers);},children:i18n.t(\"current.header.temperature\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp_max\",_this3.state.weathers);},children:i18n.t(\"current.header.maximumTemperature\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weatherMain.temp_min\",_this3.state.weathers);},children:i18n.t(\"current.header.minimalTemperature\")}),/*#__PURE__*/_jsx(\"th\",{onClick:function onClick(){return _this3.refreshWeathers(\"weather.description\",_this3.state.weathers);},children:i18n.t(\"current.header.description\")})]})});}},{key:\"mainBody\",value:function mainBody(currentPosts,temperature){console.log(temperature.units);return/*#__PURE__*/_jsx(\"tbody\",{children:currentPosts.map(function(weather){var _convertTemperature,_convertTemperature2,_convertTemperature3,_convertTemperature4;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:weather._id}),/*#__PURE__*/_jsxs(\"td\",{children:[\" \",/*#__PURE__*/_jsx(Link,{to:{pathname:\"/forecast\",state:{\"lat\":weather.coord.lat,\"lon\":weather.coord.lon}},children:weather.name})]}),/*#__PURE__*/_jsx(\"td\",{children:weather.coord.lat}),/*#__PURE__*/_jsx(\"td\",{children:weather.coord.lon}),/*#__PURE__*/_jsx(\"td\",{children:i18n.t(\"common.countryName.\".concat(weather.sys.countryName))}),/*#__PURE__*/_jsx(\"td\",{children:weather.weatherMain.humidity}),/*#__PURE__*/_jsx(\"td\",{children:\"\".concat((_convertTemperature=convertTemperature(temperature.units,weather.weatherMain.feels_like))===null||_convertTemperature===void 0?void 0:_convertTemperature.toFixed(2)).concat(temperature.abbreviation)}),/*#__PURE__*/_jsx(\"td\",{children:\"\".concat((_convertTemperature2=convertTemperature(temperature.units,weather.weatherMain.temp))===null||_convertTemperature2===void 0?void 0:_convertTemperature2.toFixed(2)).concat(temperature.abbreviation)}),/*#__PURE__*/_jsx(\"td\",{children:\"\".concat((_convertTemperature3=convertTemperature(temperature.units,weather.weatherMain.temp_max))===null||_convertTemperature3===void 0?void 0:_convertTemperature3.toFixed(2)).concat(temperature.abbreviation)}),/*#__PURE__*/_jsx(\"td\",{children:\"\".concat((_convertTemperature4=convertTemperature(temperature.units,weather.weatherMain.temp_min))===null||_convertTemperature4===void 0?void 0:_convertTemperature4.toFixed(2)).concat(temperature.abbreviation)}),/*#__PURE__*/_jsx(\"td\",{children:getWeatherDescription(weather)})]},nanoid());})});}},{key:\"render\",value:function render(){console.log(\"som v render\");var currentWeathers=this.getWeathersOnSpecificPage();var descriptions=internationalizeDescriptions(this.state.descriptions);var countries=internationalizeCountries(this.state.countries);// let filters =     (\n// this.state.filterComponent)\nvar filters=/*#__PURE__*/_jsx(FiltersComponent,{temperatureUnits:this.props.temperature.units,countries:countries,descriptions:internationalizeDescriptions(descriptions),filters:this.state.filters,onChangeMethod:this.onChangeFilter,temperature:this.props.temperature},nanoid());var pagination=/*#__PURE__*/_jsx(Pagination,{currentPage:this.state.currentPage,showPages:this.state.showPages,itemsPerPage:this.state.itemsPerPage,totalItems:this.state.weathers.length,paginate:this.paginate},nanoid());// const temperatureDropdownListComponent = temperatureDropdownList( (units, abbreviation ) => {\n// this.setState({\"temperature\": {\"units\" : units, \"abbreviation\" : abbreviation}})\n// })\nvar container=[filters,pagination];if(this.state.weathers)container.push(/*#__PURE__*/_jsxs(\"table\",{className:\"weatherTable\",children:[this.header(),this.mainBody(currentWeathers,this.props.temperature)]},nanoid()));return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:container});}}]);return WeatherCurrent;}(React.Component);export default WeatherCurrent;","map":{"version":3,"sources":["/home/prepelicamangalica/WorkspaceGit/SuperProjekt/src/main/ui/src/components/current/WeatherCurrent.js"],"names":["React","WeatherCurrentService","Pagination","FiltersComponent","Link","internationalizeDescriptions","convertTemperature","internationalizeCountries","keyExistsInArr","findIndexInFilters","nanoid","connect","saveFilter","i18n","WeatherCurrent","props","console","log","temperature","addFilterOperatorToExistingFilterName","event","filterName","filterOperator","arr","state","filters","forEach","item","index","hasOwnProperty","onChangeFilter","setState","currentPage","isFilter","isAdditionalFilter","changeFilters","refreshWeathers","sortBy","weathers","concat","isAdditionalFilterCheck","createForecast","paginate","page","getWeathersOnSpecificPage","indexOfLastPost","itemsPerPage","indexOfFirstPost","slice","changeLanguage","language","isAscending","loading","pageNumbers","countries","descriptions","showPages","filterComponent","retrieveAllCountries","retrieveAllDescriptions","data","units","retrieveAllWeathers","then","response","Object","keys","length","splice","isNotAdditionalFilterWithContains","isSameFilterChanged","includes","t","currentPosts","map","weather","_id","pathname","coord","lat","lon","name","sys","countryName","weatherMain","humidity","feels_like","toFixed","abbreviation","temp","temp_max","temp_min","getWeatherDescription","currentWeathers","pagination","container","push","header","mainBody","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport WeatherCurrentService from '../../adapters/WeatherCurrentService';\nimport Pagination from '../current/Pagination'\nimport FiltersComponent from './Filters'\nimport { Link } from \"react-router-dom\";\nimport {internationalizeDescriptions, convertTemperature, internationalizeCountries, keyExistsInArr, findIndexInFilters} from '../../businessLogic/WeatherBusinessLogic';\nimport '../../styles/common/Header.scss';\nimport { nanoid } from \"nanoid\";\nimport { connect } from 'react-redux';\nimport { saveFilter } from '../../actions';\nimport i18n from 'i18next'\n\nclass WeatherCurrent extends React.Component {\n    constructor(props) {\n        console.log(props.temperature)\n        super(props)\n        this.state = {\n            weathers: [],\n            isAscending: true,\n            filters: [],\n            isFilter : false,\n            currentPage : 1,\n            itemsPerPage : 1000,\n            loading : false,\n            isAdditionalFilter : false,\n            pageNumbers : [],\n            countries : [],\n            descriptions: [],\n            showPages: 5,\n            language: i18n.language,\n            filterComponent: null,\n            temperature: props.temperature\n        }\n    }\n\n    //I added temperatureDropdownList, filterscomponent and header here because I do not want to rerender them\n    //on every update. I cant use shouldComponentUpdate because they either are not components or are functional\n    //meaning they are stateless\n    async componentDidMount() {\n        console.log(\"componentDidMount\")\n        console.log(this.state.temperature)\n        const countries = await WeatherCurrentService.retrieveAllCountries()\n        const descriptions = await WeatherCurrentService.retrieveAllDescriptions()\n        this.setState({countries : countries.data, descriptions : (descriptions.data),\n            filterComponent: <FiltersComponent key={nanoid()} temperatureUnits = {this.state.temperature.units} countries = {internationalizeCountries(countries.data)}\n            descriptions = {internationalizeDescriptions(descriptions.data)} onChangeMethod={this.onChangeFilter} />\n        },\n            function() {this.refreshWeathers()}\n        )\n        \n    }\n    refreshWeathers(sortBy, weathers) {\n\n        WeatherCurrentService.retrieveAllWeathers(sortBy, this.state.isAscending, this.state.filters, this.state.isFilter, this.state.isAdditionalFilter, weathers)\n            .then(\n                response => {\n                    this.setState({ weathers: response.data })\n                }\n            ).then( () => {if (sortBy) this.setState({isAscending : !this.state.isAscending})}\n            ).then( () => {if (typeof this.state.filters !== 'undefined' && this.state.filters === 0) this.setState({isFilter : false})})\n    }\n\n    changeFilters(index, filterName, filterOperator) {\n        let arr = this.state.filters\n\n        if (arr[index][filterName][filterOperator])\n            delete arr[index][filterName][filterOperator]  \n        if (Object.keys(arr[index][filterName]).length === 0)\n            arr.splice(index, 1)\n        return arr\n    }\n\n    addFilterOperatorToExistingFilterName = (event, filterName, filterOperator) => {\n        const arr = this.state.filters\n        arr.forEach((item, index, filters) => {\n            if (item.hasOwnProperty([filterName])){\n                filters[index][filterName][filterOperator] = event\n            }\n        })\n        return arr\n    }\n\n    onChangeFilter = (event, filterName, filterOperator) => {\n        var index;\n\n        if (event === \"\" && keyExistsInArr(this.state.filters,filterName))  {\n\n            index = findIndexInFilters(this.state.filters, filterName)\n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : false, filters : this.changeFilters(index, filterName, filterOperator)}, function () {\n                this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n        }\n\n        else if (event !== \"\" && !(keyExistsInArr(this.state.filters, filterName))){\n\n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : true,\n                 filters: this.state.filters.concat([{[filterName]: {[filterOperator] : event}}])}, function () {\n                this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n\n        }\n\n        else if (event !== \"\" && (keyExistsInArr(this.state.filters, filterName))){\n           \n            index = findIndexInFilters(this.state.filters, filterName)\n\n            \n            this.setState({currentPage : 1, isFilter : true, isAdditionalFilter : this.isAdditionalFilterCheck(event, index, filterName, filterOperator), \n                filters : this.addFilterOperatorToExistingFilterName(event, filterName, filterOperator)}, function() {\n                    this.refreshWeathers(this.state.sortBy, this.state.weathers)\n            })\n           \n        }\n        else {\n\n        }\n    }\n\n    isAdditionalFilterCheck(event, index, filterName, filterOperator){\n        if (this.isNotAdditionalFilterWithContains(event) === false)\n            return false\n        if (this.isSameFilterChanged(event, index, filterName, filterOperator) === false)\n            return false\n        return true\n                \n    }   \n\n    //if there are multiple countries and descriptions, backend must make a new query\n    //since no additional filter is added, only value. I am unable to send query request\n    //with an array element\n    isNotAdditionalFilterWithContains(event){\n       return event.includes(\",\") ? false : true\n    }\n    \n    // this check is here for times when I change the same filter multiple\n    // times in a row and the filter is same. If it is the same I cant filter\n    // from memory because I could not load some weathers\n    isSameFilterChanged(event, index, filterName, filterOperator){\n       return filterName === this.state.filters[index][filterName]\n    }\n    header(){\n       return (<thead className=\"header\">\n       <tr>\n           <th onClick={() =>this.refreshWeathers(\"_id\", this.state.weathers) }>{i18n.t(\"current.header.cityId\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"name\", this.state.weathers) }>{ i18n.t('current.header.cityName')}</th>\n           <th onClick={() =>this.refreshWeathers(\"coord.lat\", this.state.weathers) }>{i18n.t(\"current.header.latitude\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"coord.lon\", this.state.weathers) }>{i18n.t(\"current.header.longitude\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"sys.countryName\", this.state.weathers) }>{i18n.t(\"current.header.country\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.humidity\", this.state.weathers) }>{i18n.t(\"current.header.humidity\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.feels_like\", this.state.weathers) }>{i18n.t(\"current.header.feelsLike\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp\", this.state.weathers) }>{i18n.t(\"current.header.temperature\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp_max\", this.state.weathers) }>{i18n.t(\"current.header.maximumTemperature\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weatherMain.temp_min\", this.state.weathers) }>{i18n.t(\"current.header.minimalTemperature\")}</th>\n           <th onClick={() =>this.refreshWeathers(\"weather.description\", this.state.weathers) }>{i18n.t(\"current.header.description\")}</th>                                \n       </tr>\n   </thead>)\n   }\n\ncreateForecast = ()=>{\n    return (\n        <Link  to= '/forecast'></Link>\n    );\n}\n\n   mainBody(currentPosts, temperature){\n       console.log(temperature.units)\n    return (\n\n    <tbody>\n        {\n            currentPosts.map(\n                weather =>{\n                    return (<tr key={nanoid()}>\n                        <td>{weather._id}</td>\n                        <td> <Link to={{pathname: \"/forecast\", state: {\"lat\": weather.coord.lat, \"lon\": weather.coord.lon} }}>{weather.name}</Link></td>\n                        <td>{weather.coord.lat}</td>\n                        <td>{weather.coord.lon}</td>\n                        <td>{i18n.t(`common.countryName.${weather.sys.countryName}`)}</td>\n                        <td>{weather.weatherMain.humidity}</td>\n                        <td>{`${convertTemperature(temperature.units, weather.weatherMain.feels_like)?.toFixed(2)}${temperature.abbreviation}`}</td>\n                        <td>{`${convertTemperature(temperature.units, weather.weatherMain.temp)?.toFixed(2)}${temperature.abbreviation}`}</td>\n                        <td>{`${convertTemperature(temperature.units, weather.weatherMain.temp_max)?.toFixed(2)}${temperature.abbreviation}`}</td>\n                        <td>{`${convertTemperature(temperature.units, weather.weatherMain.temp_min)?.toFixed(2)}${temperature.abbreviation}`}</td>\n                        <td>{getWeatherDescription(weather)}</td>\n                    </tr>)}\n            )\n        }\n        </tbody>\n    )\n   }\n\n    paginate = (page) => {\n        // if(currentPage !== 0 && currentPage <= lastPage)\n       this.setState({currentPage : page}, function(){\n       })\n\n    }\n\n    getWeathersOnSpecificPage = () => {\n        const indexOfLastPost = this.state.currentPage * this.state.itemsPerPage;\n        const indexOfFirstPost = indexOfLastPost - this.state.itemsPerPage;\n        return this.state.weathers.slice(indexOfFirstPost, indexOfLastPost);\n    }\n\n    changeLanguage = (language, i18n) => {\n        i18n.changeLanguage(language);\n        this.setState({}, () =>{\n            this.setState({language: language})\n        })\n    };\n\n    render() {\n        console.log(\"som v render\")\n        const currentWeathers = this.getWeathersOnSpecificPage()\n        const descriptions = internationalizeDescriptions(this.state.descriptions)\n        const countries = internationalizeCountries(this.state.countries)\n        // let filters =     (\n            // this.state.filterComponent)\n        \n        let filters = <FiltersComponent key={nanoid()} temperatureUnits = {this.props.temperature.units} countries = {countries}\n            descriptions = {internationalizeDescriptions(descriptions)}\n            filters = {this.state.filters} onChangeMethod={this.onChangeFilter} temperature={this.props.temperature} />\n\n        const pagination = <Pagination key={nanoid()} currentPage={this.state.currentPage} showPages={this.state.showPages}\n        itemsPerPage = {this.state.itemsPerPage} totalItems = {this.state.weathers.length} paginate={this.paginate}/>\n\n        // const temperatureDropdownListComponent = temperatureDropdownList( (units, abbreviation ) => {\n            // this.setState({\"temperature\": {\"units\" : units, \"abbreviation\" : abbreviation}})\n        // })\n        let container= [filters, pagination]\n\n        if (this.state.weathers)\n            container.push(<table key={nanoid()} className=\"weatherTable\">\n                {this.header()}\n                {this.mainBody(currentWeathers, this.props.temperature)}\n            </table>\n            )\n\n        return (\n            <div className=\"container\">\n\n                {container}\n            </div>\n        )\n         \n    }\n}\nexport default WeatherCurrent\n"]},"metadata":{},"sourceType":"module"}